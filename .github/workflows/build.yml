name: Build KFD Exploit

on: [push, pull_request]

jobs:
  build:
    runs-on: macos-latest

    steps:
    - name: Checkout source code
      uses: actions/checkout@v3

    - name: Set up Xcode
      run: sudo xcode-select -s /Applications/Xcode.app

    - name: Compile KFD Exploit
      run: |
        SDK_PATH=$(xcrun --sdk iphoneos --show-sdk-path)
        clang -arch arm64 -isysroot $SDK_PATH -mios-version-min=15.0 -c macos_kfd.c -o macos_kfd.o
        clang -arch arm64 -isysroot $SDK_PATH -mios-version-min=15.0 -o kfdexploit macos_kfd.o

    - name: Sign the Binary
      run: |
        brew install ldid
        ldid -S kfdexploit

    - name: Upload Binary
      uses: actions/upload-artifact@v2
      with:
        name: kfdexploit
        path: kfdexploit